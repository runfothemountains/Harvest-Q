<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Harvest Q – Stage 2 (Beta)</title>
  <meta name="description" content="Harvest Q – Markets, map, and AI price suggestions (Stage 2)" />

  <!-- PWA & icons (relative paths for GH Pages / Vercel) -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#0f766e" />
  <link rel="icon" href="./logo.png" />
  <link rel="apple-touch-icon" href="./logo.png" />

  <link rel="stylesheet" href="./css/style.css" />

  <!-- Leaflet (map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script defer src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // register relative service worker so it works on GitHub Pages subpaths
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    }
  </script>
</head>
<body>
  <!-- Compare banner -->
  <div class="compare-banner">
    <strong>Compare:</strong>
    <a id="cmp-stage1" href="https://harvest-q.vercel.app/">Stage 1</a> |
    <a id="cmp-stage2" href=".">Stage 2</a>
  </div>

  <header class="hq-header">
    <div class="container">
      <div class="brand">
        <img src="./logo.png" alt="Harvest Q logo" onerror="this.style.display='none'">
        <div>
          <h1>Harvest Q <span class="beta">BETA</span></h1>
          <p id="header-sub"></p>
        </div>
      </div>
      <div class="lang-area">
        <label for="langSelect" class="muted">Language</label>
        <select id="langSelect">
          <option value="en">English</option>
          <option value="hi">हिन्दी (Hindi)</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Tabs (explicit buttons so Playground/Quick Start/Grants show up) -->
    <nav id="tabs" class="tabs" role="tablist" aria-label="Main sections">
      <button data-panel="panel-home">Home</button>
      <button data-panel="panel-farmers">Farmers</button>
      <button data-panel="panel-consumers">Consumers</button>
      <button data-panel="panel-laws">Laws</button>
      <button data-panel="panel-medical">Medical</button>
      <button data-panel="panel-trade">Trade</button>
      <button data-panel="panel-ai">AI</button>
      <button data-panel="panel-quickstart">Quick Start</button>
      <button data-panel="panel-playground">Playground</button>
      <button data-panel="panel-grants">Grants</button>
    </nav>

    <!-- HOME -->
    <section id="panel-home" role="tabpanel" hidden>
      <div class="grid two-col">
        <div>
          <div class="card">
            <h3 id="home-what-title"></h3>
            <p id="home-what-content"></p>
          </div>
          <div class="card">
            <h3>Values</h3>
            <p id="home-phil-content"></p>
            <div class="blockquote" id="home-phil-quote"></div>
          </div>
        </div>
        <div>
          <div class="card">
            <h3>Quick Filters</h3>
            <div class="toolbar">
              <label>Country
                <select id="countrySelect"></select>
              </label>
              <label>State/Region
                <select id="stateSelect"></select>
              </label>
              <label id="cityLabel">City
                <select id="citySelect"><option value="">All Cities</option></select>
              </label>
              <button class="btn" id="refreshBtn">Refresh</button>
            </div>
            <p class="footer-note" id="home-switch-note"></p>
          </div>
          <div class="card warning" id="home-warning"></div>
        </div>
      </div>
    </section>

    <!-- FARMERS -->
    <section id="panel-farmers" role="tabpanel" hidden>
      <div class="toolbar">
        <input id="farmerSearch" placeholder="" />
        <select id="modeFilter">
          <option value="all"></option>
          <option value="sale"></option>
          <option value="trade"></option>
          <option value="both"></option>
        </select>
        <select id="sortBy">
          <option value="name"></option>
          <option value="priceAsc"></option>
        </select>
        <button class="btn" id="postOpenBtn">Post a Listing</button>
      </div>
      <div id="farmerGrid" class="grid"></div>
      <div id="mapArea" class="card" style="margin-top:12px">
        <h4>Market Map</h4>
        <div id="map" style="height:360px;border-radius:8px;"></div>
        <div id="map-legend" class="legend"></div>
      </div>
    </section>

    <!-- CONSUMERS -->
    <section id="panel-consumers" role="tabpanel" hidden>
      <div class="toolbar"><input id="consumerSearch" placeholder="" /></div>
      <div id="consumerGrid" class="grid"></div>
    </section>

    <!-- LAWS -->
    <section id="panel-laws" role="tabpanel" hidden>
      <div id="lawGrid" class="grid"></div>
      <p class="muted" id="laws-disclaimer"></p>
    </section>

    <!-- MEDICAL -->
    <section id="panel-medical" role="tabpanel" hidden>
      <div id="medGrid" class="grid"></div>
    </section>

    <!-- TRADE -->
    <section id="panel-trade" role="tabpanel" hidden>
      <p class="muted" id="trade-disclaimer"></p>
    </section>

    <!-- AI -->
    <section id="panel-ai" role="tabpanel" hidden>
      <div class="card">
        <h3 id="ai-price-title"></h3>
        <div class="toolbar">
          <input id="aiCrop" list="cropList" placeholder="" />
          <datalist id="cropList"></datalist>
          <input id="aiQty" placeholder="" />
          <button class="btn" id="aiPriceBtn"><span id="ai-price-btn-text"></span></button>
        </div>
        <pre id="aiPriceOut"></pre>
      </div>

      <div class="card">
        <h3 id="ai-match-title"></h3>
        <div class="toolbar">
          <input id="aiWant" placeholder="" />
          <button class="btn" id="aiMatchBtn"><span id="ai-match-btn-text"></span></button>
        </div>
        <pre id="aiMatchOut"></pre>
      </div>

      <!-- (Optional) demo buttons previously hanging outside the HTML -->
      <div class="card">
        <h4>Quick Demos</h4>
        <button class="ai-suggest-farmers btn"
                data-crop="Tomatoes"
                data-minqty="200 kg"
                data-location="Kano">AI: Suggest Farmers</button>
        <div class="ai-result" aria-live="polite"></div>

        <button class="ai-suggest-buyers btn"
                data-crop="Tomatoes"
                data-qty="250 kg"
                data-location="Kano">AI: Suggest Buyers</button>
        <div class="ai-result" aria-live="polite"></div>

        <button class="ai-grant-triage btn"
                data-applicant="Aisha Bello"
                data-purpose="Cold-room rental to cut tomato spoilage">AI: Triage</button>
        <div class="ai-result" aria-live="polite"></div>
      </div>
    </section>

    <!-- QUICK START -->
    <section id="panel-quickstart" role="tabpanel" hidden>
      <div class="card">
        <h2>Quick Start — Try an Agent</h2>
        <div class="qs-grid">

          <!-- Farmer Agent -->
          <div class="qs-card">
            <h3>Farmer Agent</h3>
            <button class="qs-btn" data-prompt="I just harvested 500 kg of tomatoes in Kano. What price should I list them for and how soon should I post?">Try it</button>
            <button class="qs-btn" data-prompt="I want to update my cassava listing with a new quantity and photo — can you help me publish it?">Try it</button>
            <button class="qs-btn" data-prompt="My corn stock is almost sold. Can you suggest other crops buyers are currently looking for in my area?">Try it</button>
          </div>

          <!-- Buyer Agent -->
          <div class="qs-card">
            <h3>Buyer Agent</h3>
            <button class="qs-btn" data-prompt="I need 200 kg of fresh tomatoes near Abuja this week. Can you find local suppliers?">Try it</button>
            <button class="qs-btn" data-prompt="Show me nearby farmers selling organic onions under $1 per kg.">Try it</button>
            <button class="qs-btn" data-prompt="I’m sourcing yams for a restaurant chain — can you compare three best options with price and distance?">Try it</button>
          </div>

          <!-- Coop Agent -->
          <div class="qs-card">
            <h3>Coop Agent</h3>
            <button class="qs-btn" data-prompt="I have 100 kg of maize. Can you find nearby farmers so we can combine our stock for a bulk sale?">Try it</button>
            <button class="qs-btn" data-prompt="Which farmers close to me are harvesting rice this month so we can form a cooperative?">Try it</button>
            <button class="qs-btn" data-prompt="We’re trying to fill a 1-ton buyer request. Can you calculate if our co-op has enough volume?">Try it</button>
          </div>

          <!-- Inventory Agent -->
          <div class="qs-card">
            <h3>Inventory Agent</h3>
            <button class="qs-btn" data-prompt="Track my 300 kg of tomatoes stored in a cool room in Kaduna — is the storage temperature okay?">Try it</button>
            <button class="qs-btn" data-prompt="I just updated my maize silo readings. Can you tell me if moisture levels are still safe?">Try it</button>
            <button class="qs-btn" data-prompt="Can you give me a summary of what’s in stock and which crops are ready to sell first?">Try it</button>
          </div>

          <!-- Logistics Agent -->
          <div class="qs-card">
            <h3>Logistics Agent</h3>
            <button class="qs-btn" data-prompt="Plan the fastest route from Jos to Lagos for my yam delivery — I need it there within 48 hours.">Try it</button>
            <button class="qs-btn" data-prompt="Estimate fuel cost and delivery time for transporting 500 kg of tomatoes from Kano to Abuja.">Try it</button>
            <button class="qs-btn" data-prompt="We have three farms to pick up from. Can you optimize the route to save time and fuel?">Try it</button>
          </div>

          <!-- Notify Agent -->
          <div class="qs-card">
            <h3>Notify Agent</h3>
            <button class="qs-btn" data-prompt="Send a message to all buyers that my fresh tomatoes are back in stock.">Try it</button>
            <button class="qs-btn" data-prompt="Remind the driver to pick up 300 kg of maize tomorrow morning.">Try it</button>
            <button class="qs-btn" data-prompt="Notify the cooperative members that the bulk delivery is confirmed for Friday.">Try it</button>
          </div>

          <!-- Pricing Agent -->
          <div class="qs-card">
            <h3>Pricing Agent</h3>
            <button class="qs-btn" data-prompt="What’s the fair market price for 100 kg of organic onions in Lagos today?">Try it</button>
            <button class="qs-btn" data-prompt="Calculate my breakeven and suggested selling price for 1 ton of maize.">Try it</button>
            <button class="qs-btn" data-prompt="Compare tomato prices in Kano, Abuja, and Lagos so I know where to sell.">Try it</button>
          </div>

          <!-- Quality Agent -->
          <div class="qs-card">
            <h3>Quality Agent</h3>
            <button class="qs-btn" data-prompt="Check the quality of my rice lot R-221 — the moisture reading is 13.5%. Is that okay?">Try it</button>
            <button class="qs-btn" data-prompt="I want to verify that my cassava meets Grade A export standards.">Try it</button>
            <button class="qs-btn" data-prompt="Can you generate a quick quality report for my tomatoes before I list them?">Try it</button>
          </div>

          <!-- Risk Agent -->
          <div class="qs-card">
            <h3>Risk Agent</h3>
            <button class="qs-btn" data-prompt="Analyze risk for my yam shipment from Kano to Lagos — it’s a 600 km trip in hot weather.">Try it</button>
            <button class="qs-btn" data-prompt="Is it risky to store my onions another week before selling?">Try it</button>
            <button class="qs-btn" data-prompt="Check if falling tomato prices could affect my profit this month.">Try it</button>
          </div>

          <!-- Translator Agent -->
          <div class="qs-card">
            <h3>Translator Agent</h3>
            <button class="qs-btn" data-prompt="Translate my product listing from English to Hausa before I post it.">Try it</button>
            <button class="qs-btn" data-prompt="A buyer just messaged me in French — can you translate it to English for me?">Try it</button>
            <button class="qs-btn" data-prompt="I want to send a thank-you note in Hindi to a customer. Can you help me write it naturally?">Try it</button>
          </div>

          <!-- Grant Agent -->
          <div class="qs-card">
            <h3>Grant Agent</h3>
            <button class="qs-btn" data-prompt="Help me apply for the Harvest Grant to buy a solar-powered cold room.">Try it</button>
            <button class="qs-btn" data-prompt="Score this application draft for a women’s farming co-op and suggest improvements.">Try it</button>
            <button class="qs-btn" data-prompt="Check if my project to feed elderly families qualifies for the $500 community grant.">Try it</button>
          </div>

          <!-- Insights Agent -->
          <div class="qs-card">
            <h3>Insights Agent</h3>
            <button class="qs-btn" data-prompt="Give me a weekly summary of farm sales, top products, and grant approvals.">Try it</button>
            <button class="qs-btn" data-prompt="Show me which crops are selling fastest this month and where.">Try it</button>
            <button class="qs-btn" data-prompt="Generate a short SDG-9 progress report for Harvest Q in Nigeria.">Try it</button>
          </div>

          <!-- Barter Agent -->
          <div class="qs-card">
            <h3>Barter Agent</h3>
            <button class="qs-btn" data-prompt="I have 50 kg of onions but need 20 liters of palm oil. Can you find a farmer nearby willing to trade?">Try it</button>
            <button class="qs-btn" data-prompt="Match me with someone who wants maize and has rice available for barter.">Try it</button>
            <button class="qs-btn" data-prompt="Show me the best barter options available in my region so I can exchange goods without using cash.">Try it</button>
          </div>

        </div>
      </div>
    </section>

    <!-- GRANTS -->
    <section id="panel-grants" role="tabpanel" hidden>
      <div class="card">
        <h3 id="grants-title">Harvest Grant Program</h3>
        <p id="grants-sub" class="muted">
          We’re preparing to offer $500 micro-grants to farmers, consumers, and organizations
          helping feed the homeless, elderly, and those in need.
        </p>

        <div class="notice">
          <span class="badge">Coming Soon</span>
          <strong>$500 Harvest Grant</strong> applications will open once eligibility
          and partners are finalized.
        </div>

        <h4 style="margin-top:10px">Who can apply?</h4>
        <ul class="muted">
          <li>Farmers – smallholders, co-op growers, or urban farmers</li>
          <li>Consumers – individuals or families promoting local produce</li>
          <li>Organizations – pantries, shelters, or food-aid networks</li>
        </ul>

        <div class="flex" style="gap:8px;margin-top:10px">
          <a class="btn" href="mailto:grants@harvestq.org?subject=Harvest%20Grant%20Notification">
            Get Notified
          </a>
          <a class="btn secondary" href="#" target="_blank" rel="noopener">Program FAQ (soon)</a>
        </div>

        <p class="footer-note" style="margin-top:10px">
          Applications expected next stage. This announcement does not guarantee award or eligibility.
        </p>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="footer-note" id="footer-text"></footer>
  </main>

  <!-- Post Listing Modal (a11y tightened) -->
  <div id="postModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="postTitle" aria-hidden="true" hidden>
    <div class="modal-box">
      <h3 id="postTitle">Post a Listing</h3>
      <form id="postForm">
        <label>Farm name<input id="pfFarm" required></label>
        <label>Product<input id="pfProduct" required></label>

        <!-- Inline field errors & numeric constraints -->
        <label>Quantity
          <input id="pfQty" inputmode="decimal" step="0.01" min="0.01" placeholder="e.g., 40 kg / 100 lb" required>
          <span class="field-error" id="errQty" aria-live="polite"></span>
        </label>
        <label>Price
          <input id="pfPrice" inputmode="decimal" step="0.01" min="0.01" placeholder="e.g., 2.50" required>
          <span class="field-error" id="errPrice" aria-live="polite"></span>
        </label>

        <label>Mode
          <select id="pfMode">
            <option value="sale">Sale</option>
            <option value="trade">Trade</option>
            <option value="both">Both</option>
          </select>
        </label>

        <div class="flex" style="margin-top:8px;">
          <button type="submit" class="btn">Post</button>
          <button type="button" class="btn secondary" id="postCancel">Cancel</button>
        </div>

        <!-- keep general box for non-field errors -->
        <div id="postErrors" class="muted" style="margin-top:8px"></div>
      </form>
    </div>
  </div>

  <!-- Error overlay -->
  <div id="hq-error" role="dialog" aria-live="assertive" hidden>
    <div class="box">
      <h4>Something went wrong</h4>
      <pre id="hq-error-text"></pre>
      <button class="btn" onclick="document.getElementById('hq-error').hidden=true">Close</button>
    </div>
  </div>

  <script src="./js/app.js" defer></script>
</body>
</html>
