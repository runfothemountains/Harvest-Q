<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Harvest Q â€“ Stage 3 (Beta)</title>
  <meta name="description" content="Harvest Q â€“ Connecting Farmers, Consumers & Communities through Trade, Grants, and AI" />

  <!-- PWA & icons -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#0f766e" />
  <link rel="icon" href="./logo.png" />
  <link rel="apple-touch-icon" href="./logo.png" />

  <link rel="stylesheet" href="./css/style.css" />

  <!-- Leaflet Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script defer src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Service worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').then(reg => {
        if (reg.waiting) {
          reg.waiting.postMessage('SKIP_WAITING');
        }
      }).catch(() => {});
    }
  </script>
</head>
<body>
  <header class="hq-header">
    <div class="container">
      <div class="brand">
        <img src="./logo.png" alt="Harvest Q logo" onerror="this.style.display='none'">
        <div>
          <h1>Harvest Q <span class="beta">BETA</span></h1>
          <p id="header-sub">Connecting farms, communities, and AI for sustainable food systems.</p>
        </div>
      </div>
      <div class="lang-area">
        <label for="langSelect" class="muted">Language</label>
        <select id="langSelect">
          <option value="en">English</option>
          <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€ (Hindi)</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Tabs -->
    <nav id="tabs" class="tabs" role="tablist" aria-label="Main sections">
      <!-- data-panel values must match IDs WITHOUT "panel-" prefix -->
      <button data-panel="home">Home</button>
      <button data-panel="farmers">Farmers</button>
      <button data-panel="consumers">Consumers</button>
      <button data-panel="laws">Laws</button>
      <button data-panel="medical">Medical</button>
      <button data-panel="trade">Trade</button>
      <button data-panel="ai">AI</button>
      <button data-panel="grants">Grants</button>
    </nav>

    <!-- HOME -->
    <section id="panel-home" role="tabpanel" hidden>
      <div class="grid two-col">
        <div>
          <div class="card">
            <h3>Welcome to Harvest Q</h3>
            <p>
              Empowering farmers, consumers, and local organizations to trade, connect, and grow sustainably.
              Choose your country below to explore markets and community initiatives.
            </p>
          </div>
          <div class="card">
            <h3>Quick Filters</h3>
            <div class="toolbar">
              <label>Country
                <select id="countrySelect">
                  <option>US</option><option>India</option><option>Nigeria</option><option>Russia</option>
                  <option>Canada</option><option>China</option><option>Germany</option><option>Brazil</option>
                  <option>Kenya</option><option>Ethiopia</option><option>Turkey</option><option>France</option>
                  <option>Spain</option><option>Italy</option><option>Guatemala</option>
                </select>
              </label>
              <label>State/Region
                <select id="stateSelect"></select>
              </label>
              <label id="cityLabel">City
                <select id="citySelect"><option value="">All Cities</option></select>
              </label>
              <button class="btn" id="refreshBtn">Refresh</button>
            </div>
          </div>
        </div>
        <div>
          <div class="card warning" id="home-warning">
            <strong>Note:</strong> This beta shows community-driven features for the IBM Hackathon. Data is demo-only.
          </div>
        </div>
      </div>
    </section>

    <!-- FARMERS -->
    <section id="panel-farmers" role="tabpanel" hidden>
      <div class="toolbar">
        <input id="farmerSearch" placeholder="Search farmers or products..." />
        <select id="modeFilter">
          <option value="all">All</option>
          <option value="sale">For Sale</option>
          <option value="trade">Trade</option>
          <option value="both">Both</option>
        </select>
        <select id="sortBy">
          <option value="name">Name</option>
          <option value="priceAsc">Price (Low â†’ High)</option>
        </select>
        <button class="btn" id="postOpenBtn">Post a Listing</button>
      </div>
      <div id="farmerGrid" class="grid"></div>
      <div id="mapArea" class="card" style="margin-top:12px">
        <h4>Market Map</h4>
        <div id="map" style="height:360px;border-radius:8px;"></div>
        <div id="map-legend" class="legend"></div>
      </div>
    </section>

    <!-- CONSUMERS -->
    <section id="panel-consumers" role="tabpanel" hidden>
      <div class="toolbar">
        <input id="consumerSearch" placeholder="Search buyers or requests..." />
      </div>
      <div id="consumerGrid" class="grid"></div>
    </section>

    <!-- LAWS -->
    <section id="panel-laws" role="tabpanel" hidden>
      <div class="card">
        <h3>Key Agricultural and Consumer Laws</h3>
        <p>Below are essential laws that protect farmers and consumers in each participating country.</p>
      </div>

      <!-- JS will populate this grid via LAW_INFO -->
      <div id="lawGrid" class="grid">
        <div class="card"><h4>ğŸ‡ºğŸ‡¸ United States</h4><ul><li>Farm Bill â€” Crop insurance & conservation.</li><li>FSMA â€” Produce safety standards.</li><li>Fair Packaging & Labeling Act.</li></ul></div>
        <div class="card"><h4>ğŸ‡®ğŸ‡³ India</h4><ul><li>Essential Commodities Act.</li><li>Consumer Protection Act.</li><li>PM-KISAN farmer income support.</li></ul></div>
        <div class="card"><h4>ğŸ‡³ğŸ‡¬ Nigeria</h4><ul><li>Agricultural Credit Guarantee Scheme.</li><li>Consumer Protection Council Act.</li><li>Land Use Act â€” Farm ownership rights.</li></ul></div>
        <div class="card"><h4>ğŸ‡§ğŸ‡· Brazil</h4><ul><li>Agricultural Policy Law.</li><li>Consumer Defense Code.</li><li>Environmental Crimes Law.</li></ul></div>
        <div class="card"><h4>ğŸ‡¨ğŸ‡¦ Canada</h4><ul><li>Safe Food for Canadians Act.</li><li>Agricultural Products Marketing Act.</li><li>Competition Act.</li></ul></div>
        <div class="card"><h4>ğŸ‡«ğŸ‡· France</h4><ul><li>Common Agricultural Policy (EU).</li><li>Consumer Code.</li><li>Farm Transition Law.</li></ul></div>
        <div class="card"><h4>ğŸ‡°ğŸ‡ª Kenya</h4><ul><li>Agriculture & Food Authority Act.</li><li>Weights and Measures Act.</li><li>Consumer Protection Act (2012).</li></ul></div>
        <div class="card"><h4>ğŸ‡ªğŸ‡¹ Ethiopia</h4><ul><li>Cooperative Societies Proclamation.</li><li>Seed Law.</li><li>Trade & Consumer Protection Proclamation.</li></ul></div>
        <div class="card"><h4>ğŸ‡¨ğŸ‡³ China</h4><ul><li>Rural Land Contract Law.</li><li>Food Safety Law.</li><li>Farmersâ€™ Cooperatives Law.</li></ul></div>
        <div class="card"><h4>ğŸ‡ªğŸ‡¸ Spain</h4><ul><li>Agri-Food Chain Law.</li><li>Organic Production Regulation.</li><li>Consumer Rights Law.</li></ul></div>
      </div>

      <p id="laws-disclaimer" class="footer-note">
        Provided for education only. Always verify local laws before trading or exporting.
      </p>
    </section>

    <!-- MEDICAL -->
    <section id="panel-medical" role="tabpanel" hidden>
      <div class="card">
        <h3>Farmer Health & Safety</h3>
        <p>Healthy farmers sustain healthy communities. Harvest Q encourages good agricultural and medical practices.</p>
        <ul class="muted">
          <li>ğŸš° Always use clean water when washing or irrigating produce.</li>
          <li>ğŸ§¤ Wear gloves and protective gear when using fertilizers or pesticides.</li>
          <li>ğŸ’§ Stay hydrated and take shade breaks during long harvest days.</li>
          <li>ğŸ¥ Visit your local clinic for annual health checks and vaccinations.</li>
        </ul>
      </div>
      <div class="card">
        <h4>Mental & Community Wellness</h4>
        <p>Farming can be stressful â€” join local cooperatives, talk with peers, and use Harvest Q to find support groups.</p>
      </div>
    </section>

    <!-- TRADE / BARTER -->
    <section id="panel-trade" role="tabpanel" hidden>
      <div class="card">
        <h3>Community Barter Exchange</h3>
        <p>Many members exchange goods or services instead of cash. Here are current examples from different countries.</p>
      </div>

      <div class="grid">
        <div class="card"><h4>ğŸŒ½ Farm-to-Farm</h4><ul><li>Tomatoes â†” Onions</li><li>Maize â†” Rice</li><li>Groundnuts â†” Palm oil</li><li>Yams â†” Beans</li></ul></div>
        <div class="card"><h4>ğŸ¯ Value-Added</h4><ul><li>Honey â†” Fresh fruits</li><li>Soap â†” Cornmeal</li><li>Shea butter â†” Cocoa beans</li></ul></div>
        <div class="card"><h4>ğŸ„ Livestock & Feed</h4><ul><li>Goat milk â†” Poultry feed</li><li>Eggs â†” Cassava chips</li><li>Fish fingerlings â†” Maize bran</li></ul></div>
        <div class="card"><h4>ğŸŒ¿ Tools & Labor</h4><ul><li>Tractor hours â†” Harvest help</li><li>Fertilizer â†” Irrigation repair</li><li>Crates â†” Transport support</li></ul></div>
        <div class="card"><h4>ğŸ§º Community Trades</h4><ul><li>Solar lamps â†” Produce baskets</li><li>Seeds â†” School supplies</li><li>Vegetables â†” Meals for elderly</li></ul></div>
      </div>

      <p id="trade-disclaimer" class="footer-note">
        Harvest Q promotes fair barter to reduce waste and build community resilience.
      </p>
    </section>

    <!-- AI / AGENTS -->
    <section id="panel-ai" role="tabpanel" hidden>
      <div class="card">
        <h3>AI & IBM Agent Orchestrate</h3>
        <p>
          Connect to IBM watsonx Orchestrate to run agent tools for matching farmers, suggesting prices,
          and scoring grants. In demo mode, tools run locally even if IBM is not connected.
        </p>
        <button class="btn" id="connectAgentBtn">Connect IBM Agent</button>
        <p id="agentStatus" class="muted" style="margin-top:6px;">Not connected yet.</p>
      </div>

      <div class="grid two-col">
        <!-- Price helper -->
        <div class="card">
          <h4>Price Helper (AI hint)</h4>
          <label>Crop
            <input id="aiCrop" placeholder="Tomatoes" />
          </label>
          <label>Quantity
            <input id="aiQty" placeholder="40 lb" />
          </label>
          <button class="btn" id="aiPriceBtn" style="margin-top:8px;">Ask AI</button>
          <p id="aiPriceOut" class="muted" style="margin-top:8px;"></p>
        </div>

        <!-- Barter match helper -->
        <div class="card">
          <h4>Find Barter Match</h4>
          <label>What do you want to trade or find?
            <input id="aiWant" placeholder="Peaches 20 lb" />
          </label>
          <button class="btn" id="aiMatchBtn" style="margin-top:8px;">Find Match</button>
          <pre id="aiMatchOut" class="muted" style="margin-top:8px; white-space:pre-wrap;"></pre>
        </div>
      </div>

      <!-- Simple tool playground -->
      <div class="card">
        <h4>Agent Tool Playground</h4>
        <div class="toolbar">
          <label>Tool
            <select id="toolSelect">
              <option value="findSuppliers">findSuppliers</option>
              <option value="planRoute">planRoute</option>
              <option value="suggestPrice">suggestPrice</option>
              <option value="scoreGrant">scoreGrant</option>
              <option value="findBarterMatch">findBarterMatch</option>
            </select>
          </label>
          <button class="btn secondary" id="runToolBtn">Run Tool (demo)</button>
        </div>
        <div id="agentTrace" class="trace" aria-label="Agent trace log"></div>
      </div>
    </section>

    <!-- GRANTS -->
    <section id="panel-grants" role="tabpanel" hidden>
      <div class="card">
        <h3>Harvest Grant Program</h3>
        <p>Weâ€™re launching a <strong>$500 Micro-Grant</strong> to support farmers, consumers, and organizations fighting hunger and food waste.</p>
        <h4>Who Can Apply?</h4>
        <ul class="muted">
          <li>Farmers improving sustainability or food access.</li>
          <li>Consumers promoting local produce or community gardens.</li>
          <li>Organizations supporting the elderly, homeless, or low-income families.</li>
        </ul>
        <div class="flex" style="gap:8px;margin-top:10px">
          <a class="btn" href="mailto:grants@harvestq.org?subject=Harvest%20Grant%20Application">Apply Now</a>
          <a class="btn secondary" href="#">Read Program FAQ</a>
        </div>
        <p class="footer-note">Applications open soon. Stay tuned for official announcements.</p>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="footer-note" id="footer-text">Â© Harvest Q â€” Connecting Farms & Communities</footer>
  </main>

  <!-- Post Listing Modal -->
  <div id="postModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="postModalTitle" hidden>
    <div class="modal-inner">
      <h3 id="postModalTitle">Post a Farmer Listing</h3>
      <form id="postForm">
        <div class="field">
          <label for="pfFarm">Farm name</label>
          <input id="pfFarm" required />
        </div>
        <div class="field">
          <label for="pfProduct">Product</label>
          <input id="pfProduct" required />
        </div>
        <div class="field">
          <label for="pfQty">Quantity</label>
          <input id="pfQty" required />
          <div id="errQty" class="error-text"></div>
        </div>
        <div class="field">
          <label for="pfPrice">Price</label>
          <input id="pfPrice" required />
          <div id="errPrice" class="error-text"></div>
        </div>
        <div class="field">
          <label for="pfMode">Mode</label>
          <select id="pfMode">
            <option value="sale">For Sale</option>
            <option value="trade">Trade</option>
            <option value="both">Both</option>
          </select>
        </div>
        <div id="postErrors" class="error-text" style="margin-top:4px;"></div>
        <div class="modal-actions">
          <button type="button" id="postCancel" class="btn secondary">Cancel</button>
          <button type="submit" class="btn">Save Listing</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Error overlay used by showErrorOverlay -->
  <div id="hq-error" class="error-overlay" hidden>
    <div class="error-inner">
      <h3>Something went wrong</h3>
      <p id="hq-error-text">Unknown error</p>
      <button class="btn secondary" onclick="document.getElementById('hq-error').hidden=true;">Close</button>
    </div>
  </div>

  <script src="./js/app.js" defer></script>
</body>
</html>
